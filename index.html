<!DOCTYPE html>
<html lang="en">

<head>
    <title>Air Quality</title>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="stylesheet" href="static/bootstrap/css/bootstrap.min.css">

    <style>
        p {
            text-align: right;
            margin-top: 0.5em;
            padding: 20px;
            color: rgb(40, 40, 42);
        }
    </style>

    <script src="static/chart/chart.js"></script>
    <script src="static/chart/chart.min.js"></script>
    <script src="https://cdn.bootcss.com/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="static/jquery/jquery-3.5.1.js"></script>
    <script src="static/jquery/jquery.min.js"></script>
    <script src="static/bootstrap/js/bootstrap.min.js"></script>
    <!-- 这个echarts版本不匹配，似乎是 -->
    <!-- <script src="static/echarts/echarts.min.js"></script> -->


    <!-- new -->
    <script type="text/javascript" src="echarts.min.js"></script>
    <script src="echarts-gl.min.js"></script>
    <script src="bmap.min.js"></script>
    <script src="china.js"></script>
    <!-- 数据 -->
    <script src="data/2013.js"></script>
    <script src="data/2014.js"></script>
    <script src="data/2015.js"></script>
    <script src="data/2016.js"></script>
    <script src="data/2017.js"></script>
    <script src="data/2018.js"></script>
    <!-- 三个页面的主要组成部分 -->
    <script src="map.js"></script>
    <script src="bottom.js"></script>
    <script src="right.js"></script>
    <script src="left.js"></script>
    <script src="radar.js"></script>
</head>
<body>

<div>
    <nav class="navbar navbar-light" style="background-color: #424244; height: 50px;">
        <strong><h1 style="background-color: transparent; font-family: 'Times New Roman'; color: #fdfdfe;">Air Pollutants Analysis in China</h1></strong>
    </nav>
</div>


<!--Visual Container-->
<div class="container-fluid" style="background-color: rgb(40,40,42); height: 850px;">
    <div class="container-fluid">
        <div class="row" style="height: 820px;">

            <!--------------Left Column----------------->
            <div id="pcpaddr" class="col-4">
                <div id="pcp_graph" class="row"
                     style="background-color: rgb(40,40,42); border: solid; border-color: rgb(40,40,42); transform: rotate(0deg);height: 420px;"></div>
                <div id="radargraph" class="row"
                     style="background-color: rgb(40,40,42); border: solid; border-color: rgb(40,40,42); transform: rotate(0deg);height: 420px;"></div>
                <!-- <canvas id="radargraph" class="col" style="background-color: rgb(0,49,79); border: none; height: 400px;"></canvas> -->
            </div>


            <!-----------Middle Column-------------------->
            <div class="col-6" style="background-color: rgb(40,40,42); border: solid; border-color: rgb(40,40,42);">

                <div class="row" style="height: 100px;">
                    <div class="col-4" style="background-color: rgb(40,40,42); border: none; margin: auto;">
                        <h1 id="year_show" style="font-family: Georgia; text-align: center;
						color: #fdfdfe; font-size: 33px;">From 2013 to 2018<span class="caret1"></span></h1>
                    </div>
                    <div class="col-8" style="background-color: rgb(40,40,42); border: none;">
                        <div class="row" style="height: 33px;"></div>

                        <div class="row" style="height: 33px;">

                            <div class="col-lg">
                                <div id="year_select" class="btn-group btn-group-lg" role="group"
                                     style="text-align: center;">
                                    <button id="button2013" type="button" class="btn btn-outline-info">2013</button>
                                    <button id="button2014" type="button" class="btn btn-outline-info">2014</button>
                                    <button id="button2015" type="button" class="btn btn-outline-info">2015</button>
                                    <button id="button2016" type="button" class="btn btn-outline-info">2016</button>
                                    <button id="button2017" type="button" class="btn btn-outline-info">2017</button>
                                    <button id="button2018" type="button" class="btn btn-outline-info">2018</button>
                                </div>
                            </div>

                            <div class="col-4"></div>
                        </div>

                        <div class="row" style="height: 50px;"></div>

                    </div>
                </div>

                <div id="mapaddr" class="row" style="height: 501px;">
                    <!-- // 地图颜色 -->
                    <div id="app" class="col" style="background-color: rgb(40,40,42); border: none; height: 501px;">
                        Map
                    </div>
                </div>

                <div id="visual_extra" class="row" style="height: 200px;">
                    <!-- // 折线图颜色 -->
                    <canvas id="timeseries" class="col"
                            style="background-color: rgb(40,40,42); border: solid; height: 200px; border-color: rgb(40,40,42);">
                    </canvas>
                </div>
            </div>


            <!--Right Column-->
            <div class="col-2" style="background-color:rgb(40,40,42); border: solid; border-color: rgb(40,40,42);">

                <div class="row" style="height: 70px;">
                    <div class="col" style="background-color: rgb(40,40,42); border: none; height: 60px;">
                        <div class="row" style="height: 20px;">
                        </div>

                        <div id="afteryear" class="row">
                            <div class="col"><strong><h2 id="pollutetitle"
                                                         style="text-align: center; color: #fdfdfe; font-size: 16px; margin: auto; padding: 0;">
                                Overview <br> (Average AQI from 2013 to 2018)</h2></strong></div>
                        </div>
                    </div>
                </div>

                <div id="addr" class="row">
                    <div id="pollute" class="col"
                            style="background-color: rgb(40,40,42); border: none; height: 741px;"></div>

                    <!-- <div id="radargraph" style="width: 400px;height:400px;"></div> -->

                </div>

            </div>

        </div>
    </div>
</div>


<!-- ---------footer container---------------- -->
<div class="container-fluid bg" style="background-color: #414143; height: 30px;">
</div>

<!-- 下面这段代码的作用应该是调用其他js提供的功能，然后来构建最后的图，只有这里才有针对元素的选择。 -->

<script>
    const match_list = ['安徽', '北京', '重庆', '福建', '甘肃', '广东', '广西', '贵州',
        '海南', '河北', '河南', '黑龙江', '湖北', '湖南', '吉林', '江苏', '江西', '辽宁',
        '内蒙古', '宁夏', '青海', '山东', '山西', '陕西', '上海', '四川',
        '台湾', '天津', '西藏', '新疆', '香港', '云南', '浙江']//省的名字
    //省的全名
    const wholename_list = ['安徽省', '北京市', '重庆市', '福建省', '甘肃省', '广东省', '广西壮族自治区', '贵州省', '海南省', '河北省', '河南省', '黑龙江省', '湖北省', '湖南省', '吉林省', '江苏省', '江西省', '辽宁省', '内蒙古自治区', '宁夏回族自治区', '青海省', '山东省', '山西省', '陕西省', '上海市', '四川省', '台湾省', '天津市', '西藏自治区', '新疆维吾尔自治区', '香港特别行政区', '云南省', '浙江省']
    //污染源以及单位
    const pollute_list = ['PM10(微克每立方米)', 'PM2.5(微克每立方米)',
        'SO2(微克每立方米)', 'NO2(微克每立方米)', 'CO(毫克每立方米)',
        'O3(微克每立方米)']
    //污染源名字
    const label_list = ['PM10', 'PM2.5', 'Surlfur Dioxide', 'Nitrogen Dioxide',
        'Carbon Monoxide', 'Ozone']
    //default，这个又是污染源
    var select_list = ['PM10', 'PM2.5', 'SO2', 'NO2', 'CO', 'O3']

    $(document).ready(function () {//控制组件

        //experiments
        var wholedata = [data2013, data2014, data2015, data2016, data2017, data2018];//这些都是数据，具体可以看data文件夹下面的东西
        var yeartext = ["2013", "2014", "2015", "2016", "2017", "2018"];//上面的数据对应的年份

        //overview (2013-2018)
        //构建右边那个柱状图。
        var grapharea = echarts.init(document.getElementById('pollute'));//这个是获取pollut这个元素，这个就是右边那个柱状图
        config = each_pollute(wholedata, 'AQI', 'AQI', match_list, wholename_list);
        grapharea.setOption(config);
        //构建中间下面的那个线图
        ts = time_whole_AQI(wholedata, yeartext);
        var ts = new Chart(document.getElementById('timeseries'), ts);
        //构建左边的pcp图
        pcpchart = echarts.init(document.getElementById("pcp_graph"));
        pcpchart.setOption(pcp_whole(wholedata, match_list, wholename_list, 'whole'), true);
        //whole year average for overview
        //这个app指的是中间那个中国地图***********
        mapchart = echarts.init(document.getElementById("app"));
        mapchart.setOption(map_make(wholedata, match_list, wholename_list), true);
		// 平行坐标轴
        mapchart.on('click', params => {
            $("div#pcp_graph").remove();
            $("div#pcpaddr").append('<div id="pcp_graph" class="row" style="background-color: rgb(40,40,42); border: solid; border-color: rgb(40,40,42); transform: rotate(0deg); height: 420px;"></div>');
            pcpchart = echarts.init(document.getElementById("pcp_graph"));
            pcpchart.setOption(pcp_whole(wholedata, match_list, wholename_list, params.data['name']), true);

        })
        //雷达图
        var grapharea = echarts.init(document.getElementById('radargraph'));
        var option2 = construct_aradar(data2013, wholename_list);
        grapharea.setOption(option2);
        //if select year，根据选中的年份来切换中间地图展示的数据，和左边展示的pcp图，但是这个东西真的是比较好但是，这个是年份的按钮绑定的函数，按下后就会执行一些操作
        $('#year_select button').on('click', function () {
            var txt = ($(this).text());
            var text = 'In ' + txt + '...';//这个是故意设置成这样的省略号。
            $("h1#year_show").html(text + ' <span class="caret1"></span>');

            const year_index = yeartext.indexOf(txt);//获取对应的年份
            var data = wholedata[year_index];//获取对应年份的数据。
            console.log(txt);

            var str = '#button' + txt;
            
            //这边的操作似乎就是将之前的图移出，然后重新画一个放上去
            
            for (let i = 0; i < 6; i++) {
                $('#button'+(2013+i).toString()).css('background-color', 'rgb(40,40,42)');               
            }
            $(str).css('background-color', 'rgb(56,111,219)');  // 选中按钮后的背景颜色

            $("div#afteryear div").remove();
            // 右图 上方 选择年份后的文字
            $("div#afteryear").append('<div class="col-8"><strong><h6 id="pollutetitle" style="text-align: center; color: #fdfdfe; font-size: 14px; margin: auto; padding: 0;)">Pollutants Analysis for</br>PM10 (μg/m³)</h6></strong></div><div class="col-4"><div class="dropdown" style="text-align: center;"><button class="btn btn-outline-info dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-expanded="false">PM10 <span class="caret"></span></button><ul id="dropdown_list" class="dropdown-menu" role="menu"><li><a class="dropdown-item" href="#">PM10</a></li><li><a class="dropdown-item" href="#">PM2.5</a></li><li><a class="dropdown-item" href="#">SO2</a></li><li><a class="dropdown-item" href="#">NO2</a></li><li><a class="dropdown-item" href="#">CO</a></li><li><a class="dropdown-item" href="#">O3</a></li></ul></div></div>');

            // 选择年份后的折线图
            $("canvas#timeseries").remove();
            $("div#visual_extra").append('<canvas id="timeseries" class="col" style="background-color: rgb(40,40,42); border: solid; height: 200px; border-color: rgb(40,40,42);"></canvas>');
            timeseries = time_year_AQI(data, txt);//重新放置数据
            var timeseries = new Chart(document.getElementById('timeseries'), timeseries);

            // 右图 年份 背景
            $("div#pollute").remove();
            $("div#addr").append('<div id="pollute" class="col" style="background-color:rgb(40,40,42); border:none; height:741px;"></div>');
            var grapharea =  echarts.init(document.getElementById('pollute'));
            config = each_pollute(data, pollute_list[0], label_list[0], match_list, wholename_list);
            // var pollute = new Chart(grapharea, config);
            grapharea.setOption(config);

            // 左上图
            $("div#pcp_graph").remove();
            $("div#radargraph").remove();
            $("div#pcpaddr").append('<div id="pcp_graph" class="row" style="background-color: rgb(40,40,42); border: solid; border-color: rgb(40,40,42); transform: rotate(0deg);height: 420px;"></div>');
            // 雷达图
            $("div#pcpaddr").append('<div id="radargraph" class="row" style="background-color: rgb(40,40,42); border: solid; border-color: rgb(40,40,42); transform: rotate(0deg);height: 420px;"></div>');

            pcpchart = echarts.init(document.getElementById("pcp_graph"));
            pcpchart.setOption(pcp_make(data, match_list, wholename_list, "whole"), true);

            grapharea = echarts.init(document.getElementById('radargraph'));
            option2 = construct_aradar(data, wholename_list);
            grapharea.setOption(option2);


            //这个是右边下拉框对应的事件函数，用于更新条形图的数据。
            $('#dropdown_list a').on('click', function () {
                var txt1 = ($(this).text());
                console.log(txt1);
                const index = select_list.indexOf(txt1);
                //alert("Your Favourite Sports is "+txt);
                $("button#dropdownMenuButton").html($(this).text() + ' <span class="caret"></span>');
                if (txt1 == "O3") {
                    $("h6#pollutetitle").html('Pollutants Analysis for ' + label_list[index] + ' (mg/m³)');
                } else {
                    $("h6#pollutetitle").html('Pollutants Analysis for ' + label_list[index] + ' (μg/m³)');
                }
                //重画右边的条形图
                $("div#pollute").remove();
                $("div#addr").append('<div id="pollute" class="col" style="background-color:rgb(40,40,42); border:none; height:741px;"></div>');
                var grapharea =  echarts.init(document.getElementById('pollute'));
                config = each_pollute(data, pollute_list[index], label_list[index], match_list, wholename_list);
                // var pollute = new Chart(grapharea, config);
                grapharea.setOption(config);
            });

            //重画中间的地图
            $("div#app").remove();
            $("div#mapaddr").append('<div id="app" class="col" style="background-color: rgb(40,40,42); border: none;"></div>');
            mapchart = echarts.init(document.getElementById("app"));
            mapchart.setOption(map_make(data, match_list, wholename_list), true);

            //地图被点击以后需要重新绘制pcp图和下面的线图
            mapchart.on('click', params => {
                var index = match_list.indexOf(params.data['name']);

                $("div#pcp_graph").remove();
                $("div#radargraph").remove();
                $("div#pcpaddr").append('<div id="pcp_graph" class="row" style="background-color: rgb(40,40,42); border: solid; border-color: rgb(40,40,42); transform: rotate(0deg);height: 420px;"></div>');
                $("div#pcpaddr").append('<div id="radargraph" class="row" style="background-color: rgb(40,40,42); border: solid; border-color: rgb(40,40,42); transform: rotate(0deg);height: 420px;"></div>');

                pcpchart = echarts.init(document.getElementById("pcp_graph"));
                pcpchart.setOption(pcp_make(data, match_list, wholename_list, params.data['name']), true);

                grapharea = echarts.init(document.getElementById('radargraph'));
                option2 = construct_aradar(data, wholename_list);
                grapharea.setOption(option2);
                // 年份 + 城市 折线图
                $("canvas#timeseries").remove();
                $("div#visual_extra").append('<canvas id="timeseries" class="col" style="background-color: rgb(40,40,42); border: solid; height: 200px; border-color: rgb(40,40,42);"></canvas>');
                year = yeartext[wholedata.indexOf(data)];
                timeseries = time_AQI(data, wholename_list[index], year);
                var timeseries = new Chart(document.getElementById('timeseries'), timeseries);

            })
        });

    });

</script>
</body>
</html>
